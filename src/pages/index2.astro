---
import Layout from "../layouts/Layout.astro";
const db = Astro.locals.runtime.env.DB;
const result = await db.prepare("SELECT * FROM dispositivos;").run();
console.log(result.results);

let image = [0, 1, 2, 3];

//let imagen;
if (Astro.cookies.has("id")) {
  const cookie = Astro.cookies.get("id");
  const id = cookie?.number();
  const result = await db
    .prepare(`SELECT * FROM dispositivos id = ${id};`)
    .run();
  console.log(result.results);
  //imagen = result.results[id].imagen;
} else {
  const result = await db.prepare(`SELECT * FROM dispositivos;`).run();
  let id = 0;
  for (let i = 0; i < result.results.length; i++) {
    if (result.results[i].id > id) {
      id = result.results[i].id;
    }
    for (let j = 0; j < image.length; j++) {
      if (result.results[i].imagen == image[j]) {
        image.splice(j, 1);
      }
    }
  }
  await db
    .prepare(`INSERT INTO dispositivos (imagen) VALUES (${image[0]});`)
    .run();
  // Astro.cookies.set('id', id)
}
---

<Layout title="Welcome to Astro.">
  <img src=`/${image}.jpg` alt="taza" class="custom-image" />

  <style>
    .custom-image {
      width: 200px; /* Cambia el tamaño según tus necesidades */
      height: 200px; /* Mantiene la proporción de la imagen */
    }
  </style>
</Layout>
